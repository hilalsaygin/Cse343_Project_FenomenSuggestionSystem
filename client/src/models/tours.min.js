'use strict';const mongoose=require("mongoose"),slugify=require("slugify"),tourSchema=new mongoose.Schema({username:{type:String,null:!0},website:{type:String,null:!0},name:{type:String,null:!0},biography:{type:String,null:!0},followers_count:{type:Number,null:!0},media_count:{type:Number,null:!0},profile_picture_url:{type:String,null:!0},id:{type:String,null:!0}});tourSchema.virtual("durationWeeks").get(function(){return this.duration/7});
tourSchema.pre("save",function(a){this.slug=slugify(this.name,{lower:!0});a()});tourSchema.pre(/^find/,function(a){this.find({secretTour:{$ne:!0}});this.start=Date.now();a()});tourSchema.post(/^find/,function(a,b){console.log(`Query took ${Date.now()-this.start} milliseconds!`);b()});tourSchema.pre("aggregate",function(a){this.pipeline().unshift({$match:{secretTour:{$ne:!0}}});console.log(this.pipeline());a()});const Tour=mongoose.model("Tour",tourSchema);module.exports=Tour;